import{U as cs,j as e,h as as,u as A,B as C,L as Ns,F as S,m as le,V as D,K as he,d as o,c as y,ai as ce,x as Q,aj as de,ak as J,z as ue,E as Z,b as ds,W as q,X as W,M as Ie,e as Be,f as Ye,g as B,a1 as me,al as Ee,aA as Es,aB as Ls,aC as qe,aD as Os,aE as We,S as Ne,N as $,aW as $s,a9 as us,a7 as He,n as xe,A as Le,a3 as Is,a4 as Bs,R as ie,aw as hs,H as oe,ap as pe,ax as ms,aK as xs,aF as Ys,aG as Hs}from"./chakra-BFMGxYLr.js";import{y as N,u as Vs,Q as Oe,U as Gs,a0 as Us,c as Xs,h as rs,aa as ns,H as Ks,ao as Qs,a8 as Js,p as Zs}from"./index-Dge-MEAl.js";import{P as $e}from"./Pagination-DQ16zan4.js";import{a as r,u as et}from"./react-6s1XWRBU.js";import{f as st}from"./courseService-3S11OU7p.js";const tt=async(s={})=>(await N.get("/requests",{params:s})).data,at=async(s={})=>{const c={};return s.course_name&&(c.course_name=s.course_name),s.current_day&&(c.current_day=s.current_day),s.desired_day&&(c.desired_day=s.desired_day),(await N.get("/requests",{params:c})).data},rt=async(s={})=>(await N.get("/my-requests",{params:s})).data,nt=async()=>(await N.get("/my-applications")).data,it=async s=>(await N.post("/requests",s)).data,ot=async s=>(await N.get(`/requests/${s}`)).data,ps=async(s,c)=>(await N.put(`/requests/${s}`,c)).data,lt=async s=>(await N.delete(`/requests/${s}`)).data,ct=async(s,c={})=>(await N.post(`/requests/${s}/apply`,c)).data,dt=async s=>(await N.get(`/requests/${s}/applications`)).data,is=async(s,c)=>(await N.put(`/applications/${s}`,c)).data,ut=async s=>(await N.put(`/applications/${s}/withdraw`)).data,ht=5;function gs({perPage:s=ht,trigger:c=!0}={}){const[x,p]=r.useState([]),[M,d]=r.useState(!1),[f,j]=r.useState(null),[T,F]=r.useState(1),[n,b]=r.useState(1),l=r.useCallback(async(_=1)=>{d(!0),j(null);try{const w=localStorage.getItem("major_id"),R=localStorage.getItem("faculty_id"),v={...w?{major_id:w}:{},...R?{faculty_id:R}:{},page:_,per_page:s},g=await st(v);p(g.data||[]),b(g.last_page||1),F(g.current_page||1)}catch(w){j(w.message||"Failed to load courses")}finally{d(!1)}},[s]);return r.useEffect(()=>{c&&l(T)},[T,c]),{courses:x,coursesLoading:M,coursesError:f,coursesPage:T,coursesTotalPages:n,setCoursesPage:F,fetchPaginatedCourses:l}}const ge="https://bit.ly/dan-abramov",os=s=>s?{id:s.id,userId:s.user_id,userName:s.user&&s.user.first_name&&s.user.last_name?`${s.user.first_name} ${s.user.last_name}`:s.user&&s.user.username||s.userName||"You",userAvatar:s.user&&s.user.avatar_url||s.userAvatar||ge,reason:s.reason,createdAt:s.created_at||s.createdAt,status:s.status,request:s.request}:{},K=(s,c)=>{if(!s)return{};const x=s.requester||c||{};return{id:s.id,courseName:s.course_name,currentSection:s.current_section,desiredSection:s.desired_section,currentDay:s.current_day,currentTime:s.current_time,desiredDay:s.desired_day,desiredTime:s.desired_time,reason:s.reason,status:s.status,requesterId:x.id,requesterName:x.first_name&&x.last_name?`${x.first_name} ${x.last_name}`:x.name||"You",requesterAvatar:x.avatar_url||ge,createdAt:s.created_at,applications:Array.isArray(s.applications)?s.applications.map(p=>({id:p.id,requestId:s.id,userId:p.user_id||(p.user?p.user.id:void 0),status:p.status,user:p.user?{id:p.user.id,name:`${p.user.first_name} ${p.user.last_name}`}:{}})):[]}},ls=({request:s,userId:c,onApply:x,onCancel:p,onDelete:M,onViewApplications:d,onUpdateApplication:f,onUpdateApplicationStatus:j,onEdit:T})=>{var k;typeof window!="undefined"&&localStorage.getItem("role");const F=s.requesterId===c,n=A("white","gray.800"),b=A("gray.800","white"),l=A("gray.600","gray.400"),_=A("yellow.400","yellow.500"),w=A("gray.100","gray.700"),R=(k=s.applications)==null?void 0:k.some(u=>u.userId===c&&(u.status==="pending"||u.status==="accepted")),v={pending:"orange",accepted:"green",declined:"red",cancelled:"gray"},g=u=>{if(!u)return"";try{const[P,O]=u.split(":"),i=parseInt(P,10),E=i>=12?"PM":"AM";return`${i%12||12}:${O} ${E}`}catch{return u}};return e.jsxs(He,{bg:n,boxShadow:"sm",border:"1px solid",borderColor:w,borderRadius:"lg",overflow:"hidden",transition:"all 0.2s",_hover:{transform:"translateY(-2px)",boxShadow:"md"},children:[s.status!=="pending"&&e.jsx(xe,{position:"absolute",top:2,right:2,colorScheme:v[s.status],variant:"solid",borderRadius:"md",px:2,textTransform:"capitalize",fontSize:"xs",children:s.status}),e.jsx(hs,{pb:3,pt:{base:8,md:4},children:e.jsxs(S,{justify:"space-between",align:"start",direction:{base:"column",sm:"row"},gap:{base:3,sm:0},children:[e.jsxs(D,{align:"start",spacing:1,children:[e.jsx(he,{size:{base:"xs",sm:"sm"},color:b,children:s.courseName}),e.jsxs(o,{fontSize:"xs",color:l,children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs(oe,{spacing:2,flexShrink:0,children:[e.jsx(pe,{size:{base:"sm",md:"sm"},colorScheme:"blue",variant:"subtle",minW:"max-content",fontSize:{base:"xs",sm:"sm"},children:s.currentSection}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:"gray.500",children:"→"}),e.jsx(pe,{size:{base:"sm",md:"sm"},colorScheme:"green",variant:"subtle",minW:"max-content",fontSize:{base:"xs",sm:"sm"},children:s.desiredSection})]})]})}),e.jsxs(ms,{py:0,children:[e.jsxs($,{templateColumns:{base:"1fr",sm:"repeat(2, 1fr)"},gap:{base:3,sm:4},py:3,children:[e.jsxs(D,{align:"start",spacing:2,children:[e.jsxs(S,{align:"center",children:[e.jsx(C,{as:rs,mr:2,color:_}),e.jsxs(D,{spacing:0,align:"start",children:[e.jsx(o,{fontSize:"xs",color:l,children:"Current Day"}),e.jsx(o,{fontSize:"sm",color:b,children:s.currentDay})]})]}),e.jsxs(S,{align:"center",children:[e.jsx(C,{as:ns,mr:2,color:_}),e.jsxs(D,{spacing:0,align:"start",children:[e.jsx(o,{fontSize:"xs",color:l,children:"Time"}),e.jsx(o,{fontSize:"sm",color:b,children:g(s.currentTime)})]})]})]}),e.jsxs(D,{align:"start",spacing:2,children:[e.jsxs(S,{align:"center",children:[e.jsx(C,{as:rs,mr:2,color:_}),e.jsxs(D,{spacing:0,align:"start",children:[e.jsx(o,{fontSize:"xs",color:l,children:"Desired Day"}),e.jsx(o,{fontSize:"sm",color:b,children:s.desiredDay})]})]}),e.jsxs(S,{align:"center",children:[e.jsx(C,{as:ns,mr:2,color:_}),e.jsxs(D,{spacing:0,align:"start",children:[e.jsx(o,{fontSize:"xs",color:l,children:"Time"}),e.jsx(o,{fontSize:"sm",color:b,children:g(s.desiredTime)})]})]})]})]}),s.reason&&e.jsxs(C,{mt:2,p:3,bg:A("gray.50","gray.700"),borderRadius:"md",children:[e.jsx(o,{fontSize:"sm",color:l,noOfLines:2,children:s.reason}),j&&s.applications&&s.applications.length>0&&e.jsxs(C,{pt:4,mt:4,borderTopWidth:"1px",borderColor:w,children:[e.jsx(he,{size:"sm",mb:3,color:b,children:"Applicants"}),e.jsx(D,{spacing:4,align:"stretch",children:s.applications.map(u=>e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsxs(S,{align:"center",children:[e.jsx(Le,{size:"sm",name:u.user.username,src:u.user.avatar}),e.jsxs(C,{ml:3,children:[e.jsx(o,{fontWeight:"bold",color:b,children:u.user.username}),e.jsx(o,{fontSize:"sm",color:l,children:u.reason})]})]}),e.jsx(C,{textAlign:"right",children:u.status==="pending"?e.jsxs(oe,{spacing:2,children:[e.jsx(y,{size:"xs",colorScheme:"green",onClick:()=>j(u.id,"approved"),children:"Approve"}),e.jsx(y,{size:"xs",colorScheme:"red",onClick:()=>j(u.id,"declined"),children:"Decline"})]}):e.jsx(xe,{colorScheme:u.status==="approved"?"green":"red",children:u.status.charAt(0).toUpperCase()+u.status.slice(1)})})]},u.id))})]})]})]}),e.jsx(xs,{pt:3,children:e.jsxs(S,{w:"100%",justify:"space-between",align:"center",direction:{base:"column",sm:"row"},gap:{base:3,sm:0},children:[e.jsxs(oe,{spacing:2,children:[e.jsx(Le,{size:"xs",src:s.requesterAvatar,name:s.requesterName}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:b,fontWeight:"medium",children:s.requesterName})]}),s.status==="pending"&&e.jsxs(oe,{spacing:2,flexWrap:"wrap",justify:{base:"center",sm:"flex-end"},children:[F&&e.jsxs(e.Fragment,{children:[e.jsx(y,{size:{base:"xs",sm:"sm"},variant:"solid",colorScheme:"blue",onClick:()=>d(s.id),fontSize:{base:"xs",sm:"sm"},children:s.applications&&s.applications.length>0?`Applicants (${s.applications.length})`:"No Applicants"}),e.jsxs(Ie,{children:[e.jsx(Be,{as:le,"aria-label":"More actions",icon:e.jsx(Oe,{style:{transform:"rotate(-90deg)"}}),size:"sm",variant:"ghost"}),e.jsxs(Ye,{children:[e.jsx(B,{icon:e.jsx(Ks,{}),onClick:()=>p(s.id),children:"Cancel"}),e.jsx(B,{icon:e.jsx(Qs,{}),onClick:()=>T(s),children:"Edit"}),e.jsx(B,{icon:e.jsx(Js,{}),color:"red.500",onClick:()=>M(s.id),children:"Delete"})]})]})]}),!F&&R&&e.jsx(y,{size:{base:"xs",sm:"sm"},colorScheme:"gray",variant:"solid",isDisabled:!0,fontSize:{base:"xs",sm:"sm"},children:"Applied"}),!F&&!R&&typeof x=="function"&&e.jsx(y,{size:{base:"xs",sm:"sm"},colorScheme:"green",variant:"solid",leftIcon:e.jsx(Zs,{}),onClick:()=>x(s.id),fontSize:{base:"xs",sm:"sm"},children:"Apply"})]})]})})]})},mt=({application:s,onWithdraw:c})=>{const[x,p]=r.useState(!1),M=r.useRef(),d=A("white","gray.800"),f=A("gray.800","white"),j=A("gray.600","gray.400"),T=A("gray.100","gray.700"),F={pending:"orange",accepted:"green",declined:"red",cancelled:"gray"},n=s.request,b=(n==null?void 0:n.courseName)||`Request #${s.request_id}`,l=(n==null?void 0:n.currentSection)||"-",_=(n==null?void 0:n.desiredSection)||"-",w=(n==null?void 0:n.currentDay)||"-",R=(n==null?void 0:n.desiredDay)||"-",v=(n==null?void 0:n.currentTime)||"-",g=(n==null?void 0:n.desiredTime)||"-";return n!=null&&n.requesterAvatar,n!=null&&n.requesterName,e.jsxs(He,{bg:d,boxShadow:"sm",border:"1px solid",borderColor:T,borderRadius:"lg",overflow:"hidden",transition:"all 0.2s",_hover:{transform:"translateY(-2px)",boxShadow:"md"},children:[e.jsx(xe,{position:"absolute",top:2,right:2,colorScheme:F[s.status],variant:"solid",borderRadius:"md",px:2,textTransform:"capitalize",fontSize:"xs",children:s.status}),e.jsx(hs,{pb:3,pt:{base:8,md:4},children:e.jsx(S,{justify:"space-between",align:"start",children:e.jsxs(D,{align:"start",spacing:1,children:[e.jsx(he,{size:{base:"xs",sm:"sm"},color:f,children:b}),e.jsxs(o,{fontSize:"xs",color:j,children:["Applied: ",new Date(s.createdAt).toLocaleDateString()]})]})})}),e.jsxs(ms,{py:0,children:[e.jsxs($,{templateColumns:{base:"1fr",sm:"repeat(2, 1fr)"},gap:{base:3,sm:4},py:3,children:[e.jsxs(D,{align:"start",spacing:2,children:[e.jsx(o,{fontSize:{base:"xs",sm:"sm"},fontWeight:"medium",color:f,children:"Current Section"}),e.jsx(pe,{size:{base:"sm",sm:"md"},colorScheme:"blue",variant:"subtle",minW:"max-content",fontSize:{base:"xs",sm:"sm"},children:l}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:j,mt:2,children:"Current Day"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:f,children:w}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:j,mt:2,children:"Current Time"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:f,children:v})]}),e.jsxs(D,{align:"start",spacing:2,children:[e.jsx(o,{fontSize:{base:"xs",sm:"sm"},fontWeight:"medium",color:f,children:"Desired Section"}),e.jsx(pe,{size:{base:"sm",sm:"md"},colorScheme:"green",variant:"subtle",minW:"max-content",fontSize:{base:"xs",sm:"sm"},children:_}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:j,mt:2,children:"Desired Day"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:f,children:R}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:j,mt:2,children:"Desired Time"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:f,children:g})]})]}),e.jsxs(C,{mt:2,p:{base:2,sm:3},bg:A("gray.50","gray.700"),borderRadius:"md",children:[e.jsx(o,{fontSize:{base:"xs",sm:"sm"},fontWeight:"medium",color:f,children:"Your Reason:"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:j,children:s.reason})]})]}),e.jsx(xs,{pt:3,children:e.jsx(S,{w:"100%",justify:"space-between",align:"center",children:c&&s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{size:{base:"xs",sm:"sm"},colorScheme:"red",variant:"outline",onClick:()=>p(!0),"aria-label":"Withdraw Application",fontSize:{base:"xs",sm:"sm"},children:"Withdraw"}),e.jsx(Ys,{isOpen:x,leastDestructiveRef:M,onClose:()=>p(!1),children:e.jsx(Q,{children:e.jsxs(Hs,{children:[e.jsx(J,{fontSize:"lg",fontWeight:"bold",children:"Withdraw Application"}),e.jsx(Z,{children:"Are you sure you want to withdraw this application? This action cannot be undone."}),e.jsxs(Ee,{children:[e.jsx(y,{ref:M,onClick:()=>p(!1),children:"Cancel"}),e.jsx(y,{colorScheme:"red",ml:3,onClick:()=>{p(!1),c(s.id)},children:"Confirm"})]})]})})})]})})})]})},xt=r.forwardRef(({onEditRequest:s},c)=>{const{isOpen:x,onOpen:p,onClose:M}=as(),d=cs(),f=et(),{user:j}=Vs(),{isOpen:T,onOpen:F,onClose:n}=as(),{courses:b,coursesLoading:l,coursesError:_,coursesPage:w,coursesTotalPages:R,setCoursesPage:v}=gs({trigger:x||T}),g=A("gray.50","gray.900"),k=A("white","gray.800"),u=A("gray.800","white"),P=A("gray.600","gray.400"),O=A("yellow.400","yellow.500"),i=A("gray.100","gray.700"),[E,Y]=r.useState([]),[V,Ve]=r.useState(1),[js,bs]=r.useState(1),[ye,pt]=r.useState("created_at"),[je,gt]=r.useState("desc"),[be,G]=r.useState([]),[fe,Ge]=r.useState(1),[fs,Ss]=r.useState(1),[Se,yt]=r.useState("created_at"),[Ce,jt]=r.useState("desc"),[Ue,Xe]=r.useState([]),[U,Ae]=r.useState(1),[we,Cs]=r.useState(1),[ve,bt]=r.useState("created_at"),[_e,ft]=r.useState("desc"),[X,H]=r.useState(!0),[L,Ke]=r.useState({course_code:"",current_day:"",desired_day:""}),[As,Qe]=r.useState(!1);r.useImperativeHandle(c,()=>({fetchAvailableRequestsPaginated:ne,fetchMyRequestsPaginated:Fe,fetchMyApplicationsPaginated:Pe}));const[ws,ee]=r.useState(!1),[vs,se]=r.useState(!1),[te,Re]=r.useState(null),[ae,ze]=r.useState(""),[De,Je]=r.useState(!1),[re,Te]=r.useState([]),ne=async(t=1,a=ye,m=je)=>{H(!0);try{const h=await tt({page:t,sort_by:a,sort_order:m});Y(Array.isArray(h.data)?h.data.map(K):[]),bs(h.last_page||1),Ve(h.current_page||1)}catch(h){d({title:"Failed to load available requests",description:h.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}finally{H(!1)}},Fe=async(t=1,a=Se,m=Ce)=>{H(!0);try{const h=await rt({page:t,sort_by:a,sort_order:m});let I=[];Array.isArray(h.data)&&(I=h.data.map(Me=>K(Me,j))),G(I),Ss(h.last_page||1),Ge(h.current_page||1)}catch(h){d({title:"Failed to load your requests",description:h.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}finally{H(!1)}},Pe=async(t=1,a=ve,m=_e)=>{H(!0);try{const h=await nt({page:t,sort_by:a,sort_order:m});Cs(h.last_page||1),Ae(h.current_page||1);const I=h.data||[],Me=Array.isArray(I)?I.map(z=>z&&z.request_id).filter(Boolean):[],ks=await Promise.all(Me.map(z=>ot(z).catch(()=>null))),ke={};ks.forEach((z,ts)=>{z&&z.id&&(ke[z.id]=z)});const qs=Array.isArray(I)?I.map(z=>{const ts=os(z),Ws=z&&z.request?K(z.request):z&&ke[z.request_id]?K(ke[z.request_id]):void 0;return{...ts,request:Ws}}):[];Xe(qs)}catch(h){d({title:"Failed to load applications",description:h.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}finally{H(!1)}};r.useEffect(()=>{ne(V,ye,je)},[V,ye,je]),r.useEffect(()=>{Fe(fe,Se,Ce)},[fe,Se,Ce]),r.useEffect(()=>{Pe(U,ve,_e)},[U,ve,_e]);const Ze=t=>{const{name:a,value:m}=t.target;Ke(h=>({...h,[a]:m}))},_s=async()=>{Qe(!0);try{const t=await at({course_name:L.course_code,current_day:L.current_day,desired_day:L.desired_day});Y(Array.isArray(t.data)?t.data.map(K):[]),n()}catch(t){d({title:"Failed to apply filters",description:t.message||"Please try again later",status:"error",duration:4e3,isClosable:!0})}finally{Qe(!1)}},Rs=async t=>{try{await ut(t),Xe(a=>a.filter(m=>m.id!==t)),ne(),d({title:"Application withdrawn",description:"Your application has been successfully withdrawn.",status:"info",duration:3e3,isClosable:!0})}catch(a){d({title:"Failed to withdraw application",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},es=async t=>{if(window.confirm("Are you sure you want to delete this request? This cannot be undone."))try{await lt(t),G(a=>a.filter(m=>m.id!==t)),d({title:"Request deleted",status:"info",duration:3e3,isClosable:!0})}catch(a){d({title:"Failed to delete request",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},zs=t=>{Re(t),ze(""),ee(!0)},Ds=async()=>{if(!De){Je(!0);try{await ct(te,{reason:ae}),Y(t=>t.map(a=>a.id===te?{...a,applications:[...a.applications||[],{id:Date.now().toString(),userId:j.id,userName:"You",userAvatar:ge,reason:ae,createdAt:new Date().toISOString(),status:"pending"}]}:a)),await Pe(),d({title:"Application submitted",description:"Your application has been submitted to the request owner.",status:"success",duration:3e3,isClosable:!0}),ee(!1),ze(""),Re(null)}catch(t){d({title:"Failed to submit application",description:t.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}finally{Je(!1)}}},ss=async t=>{try{const a=await dt(t);Re(t),Te(a.map(os)),se(!0)}catch(a){d({title:"Failed to load applications",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},Ts=async t=>{try{await is(t,{status:"accepted"});const a=re.map(m=>m.id===t?{...m,status:"accepted"}:{...m,status:m.status==="pending"?"declined":m.status});Te(a),G(m=>m.map(h=>h.id===te?{...h,status:"accepted",applications:a}:h)),se(!1),d({title:"Application accepted",description:"You have accepted the application for your class exchange request.",status:"success",duration:3e3,isClosable:!0})}catch(a){d({title:"Failed to accept application",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},Fs=async t=>{try{await is(t,{status:"declined"});const a=re.map(m=>m.id===t?{...m,status:"declined"}:m);Te(a),G(m=>m.map(h=>h.id===te?{...h,applications:a}:h)),d({title:"Application declined",description:"You have declined the application for your class exchange request.",status:"info",duration:3e3,isClosable:!0})}catch(a){d({title:"Failed to decline application",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},Ps=async t=>{try{await ps(t,{status:"cancelled"}),G(a=>a.map(m=>m.id===t?{...m,status:"cancelled"}:m)),d({title:"Request cancelled",description:"Your class exchange request has been cancelled.",status:"info",duration:3e3,isClosable:!0})}catch(a){d({title:"Failed to cancel request",description:a.message||"Please try again later",status:"error",duration:5e3,isClosable:!0})}},Ms=()=>{f(-1)};return e.jsxs(C,{minH:"100vh",bg:g,p:{base:2,sm:4,md:6},children:[e.jsxs(Ns,{maxW:"7xl",children:[e.jsxs(S,{mb:{base:4,md:8},align:"center",children:[e.jsx(le,{icon:e.jsx(Oe,{}),onClick:Ms,"aria-label":"Go back",variant:"ghost",color:u,size:{base:"md",md:"lg"},mr:{base:2,md:3},_hover:{bg:A("gray.100","gray.700")}}),e.jsxs(D,{align:"start",spacing:1,children:[e.jsx(he,{size:{base:"md",md:"lg"},color:u,children:"Class Exchange Requests"}),e.jsx(o,{fontSize:{base:"xs",sm:"sm"},color:P,display:{base:"none",sm:"block"},children:"Manage your class time exchange requests"})]})]}),e.jsxs(C,{bg:k,borderRadius:"xl",boxShadow:"sm",borderWidth:"1px",borderColor:i,children:[e.jsxs(S,{justify:"flex-end",p:{base:3,md:6},borderBottomWidth:"1px",borderColor:i,gap:{base:2,md:3},flexWrap:"wrap",children:[e.jsx(y,{colorScheme:"yellow",leftIcon:e.jsx(Gs,{}),onClick:F,size:{base:"sm",md:"md"},fontSize:{base:"xs",sm:"sm"},children:"Filters"}),e.jsx(y,{leftIcon:e.jsx(Us,{}),onClick:p,colorScheme:"yellow",size:{base:"sm",md:"md"},fontSize:{base:"xs",sm:"sm"},children:"New Request"})]}),e.jsxs(ce,{isOpen:T,onClose:n,isCentered:!0,children:[e.jsx(Q,{}),e.jsxs(de,{children:[e.jsx(J,{children:"Filter Requests"}),e.jsx(ue,{}),e.jsx(Z,{children:e.jsxs(ds,{spacing:4,children:[e.jsxs(q,{children:[e.jsx(W,{children:"Course"}),e.jsxs(Ie,{isLazy:!0,children:[e.jsx(Be,{as:y,width:"100%",rightIcon:e.jsx("span",{style:{marginLeft:8},children:"▼"}),isLoading:l,isDisabled:l||!!_,textAlign:"left",children:L.course_code?(()=>{const t=b.find(a=>a.code===L.course_code);return t?`${t.code} - ${t.title}`:L.course_code})():l?"Loading courses...":"Select course"}),e.jsxs(Ye,{maxH:"250px",overflowY:"auto",minW:"250px",px:0,children:[_?e.jsx(B,{isDisabled:!0,children:"Failed to load courses"}):b.length===0&&!l?e.jsx(B,{isDisabled:!0,children:"No courses found"}):b.map(t=>e.jsx(B,{value:t.title,onClick:()=>Ke(a=>({...a,course_code:t.code})),_active:{bg:"gray.100"},_selected:{fontWeight:"bold",bg:"gray.200"},style:L.course_code===t.code?{fontWeight:"bold",background:"#f7fafc"}:{},children:t.code?`${t.code} - ${t.title}`:t.title},t.id)),e.jsx(C,{borderTop:"1px solid #eee",mt:2,pt:2,px:2,children:e.jsxs(S,{justify:"space-between",align:"center",children:[e.jsx(y,{size:"xs",onClick:t=>{t.stopPropagation(),v(a=>Math.max(1,a-1))},isDisabled:l||w<=1,children:"Prev"}),e.jsxs(o,{fontSize:"xs",children:["Page ",w," of ",R]}),e.jsx(y,{size:"xs",onClick:t=>{t.stopPropagation(),v(a=>Math.min(R,a+1))},isDisabled:l||w>=R,children:"Next"})]})})]})]})]}),e.jsxs(q,{children:[e.jsx(W,{children:"Current Day"}),e.jsxs(me,{placeholder:"Select current day",name:"current_day",value:L.current_day,onChange:Ze,children:[e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"})]})]}),e.jsxs(q,{children:[e.jsx(W,{children:"Desired Day"}),e.jsxs(me,{placeholder:"Select desired day",name:"desired_day",value:L.desired_day,onChange:Ze,children:[e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"})]})]})]})}),e.jsxs(Ee,{children:[e.jsx(y,{onClick:n,mr:3,variant:"ghost",children:"Cancel"}),e.jsx(y,{colorScheme:"yellow",onClick:_s,isLoading:As,children:"Apply Filters"})]})]})]}),e.jsxs(Es,{variant:"soft-rounded",colorScheme:"yellow",children:[e.jsxs(Ls,{px:{base:2,md:6},pt:4,pb:2,mb:4,overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap",css:{"&::-webkit-scrollbar":{height:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:A("gray.300","gray.600"),borderRadius:"2px"}},children:[e.jsx(qe,{fontSize:{base:"xs",sm:"sm"},px:{base:3,sm:4},_selected:{fontWeight:"semibold",color:u,bg:`${O}20`},children:"Available"}),e.jsxs(qe,{fontSize:{base:"xs",sm:"sm"},px:{base:3,sm:4},_selected:{fontWeight:"semibold",color:u,bg:`${O}20`},children:["My Requests (",be.length,")"]}),e.jsx(qe,{fontSize:{base:"xs",sm:"sm"},px:{base:3,sm:4},_selected:{fontWeight:"semibold",color:u,bg:`${O}20`},children:"My Applications"})]}),e.jsxs(Os,{px:{base:2,md:6},py:0,children:[e.jsx(We,{p:0,children:X?e.jsx(S,{justify:"center",py:10,children:e.jsx(Ne,{size:"xl"})}):E.length>0?e.jsxs(e.Fragment,{children:[e.jsx($,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)",xl:"repeat(3, 1fr)"},gap:{base:4,md:6},children:E.map(t=>e.jsx(ls,{request:t,userId:j.id,onApply:zs,onViewApplications:ss,onEdit:s,onDelete:es},t.id))}),e.jsx($e,{currentPage:V,totalPages:js,onPageChange:Ve,isLoading:X})]}):e.jsx(C,{p:12,textAlign:"center",borderWidth:"2px",borderStyle:"dashed",borderColor:i,borderRadius:"lg",children:e.jsx(o,{color:P,children:"No available requests at this time"})})}),e.jsx(We,{p:0,children:X?e.jsx(S,{justify:"center",py:10,children:e.jsx(Ne,{size:"xl"})}):be.length>0?e.jsxs(e.Fragment,{children:[e.jsx($,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)",xl:"repeat(3, 1fr)"},gap:{base:4,md:6},children:be.map(t=>e.jsx(ls,{request:t,userId:j.id,onCancel:Ps,onDelete:es,onViewApplications:ss,onEdit:s},t.id))}),e.jsx($e,{currentPage:fe,totalPages:fs,onPageChange:Ge,isLoading:X})]}):e.jsx(C,{p:12,textAlign:"center",borderWidth:"2px",borderStyle:"dashed",borderColor:i,borderRadius:"lg",children:e.jsx(o,{color:P,children:"No personal requests found"})})}),e.jsx(We,{p:0,children:X?e.jsx(S,{justify:"center",py:10,children:e.jsx(Ne,{size:"xl"})}):Ue.length>0?e.jsxs(e.Fragment,{children:[e.jsx($,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(2, 1fr)",xl:"repeat(3, 1fr)"},gap:{base:4,md:6},mb:6,children:Ue.map(t=>e.jsx(mt,{application:t,onWithdraw:Rs},t.id))}),e.jsx(S,{justify:"center",mt:6,mb:4,children:e.jsxs($s,{isAttached:!0,variant:"outline",size:"sm",children:[e.jsx(le,{icon:e.jsx(Oe,{}),isDisabled:U<=1,onClick:()=>Ae(t=>Math.max(t-1,1)),"aria-label":"Previous page"}),e.jsxs(y,{isDisabled:!0,children:["Page ",U," of ",we]}),e.jsx(le,{icon:e.jsx(Xs,{}),isDisabled:U>=we,onClick:()=>Ae(t=>Math.min(t+1,we)),"aria-label":"Next page"})]})})]}):e.jsx(C,{p:12,textAlign:"center",borderWidth:"2px",borderStyle:"dashed",borderColor:i,borderRadius:"lg",children:e.jsx(o,{color:P,children:"No applications submitted yet"})})})]})]})]})]}),e.jsx(ys,{isOpen:x,onClose:M,mode:"create",initialData:{},onSubmit:async t=>{var a,m;try{const h=await it({course_name:t.courseName,current_section:t.currentSection,desired_section:t.desiredSection,current_day:t.currentDay,current_time:t.currentTime,desired_day:t.desiredDay,desired_time:t.desiredTime,reason:t.reason});await ne(),await Fe(),d({title:"Request created",description:"Your class exchange request has been submitted.",status:"success",duration:3e3,isClosable:!0}),M()}catch(h){throw d({title:"Failed to create request",description:((m=(a=h.response)==null?void 0:a.data)==null?void 0:m.message)||"Please try again later",status:"error",duration:5e3,isClosable:!0}),h}},courses:b,coursesLoading:l,coursesError:_,coursesPage:w,coursesTotalPages:R,onCoursePageChange:v}),e.jsxs(ce,{isOpen:ws,onClose:()=>ee(!1),size:"md",children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(5px)"}),e.jsxs(de,{bg:k,borderRadius:"xl",children:[e.jsx(J,{color:u,children:"Apply for Class Exchange"}),e.jsx(ue,{}),e.jsxs(Z,{children:[e.jsxs(D,{spacing:4,align:"stretch",children:[e.jsx(o,{fontSize:"sm",color:P,children:"Submit your application to exchange class times with the requester. The requester will review all applications and select one to accept."}),e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{color:u,children:"Why do you want to exchange?"}),e.jsx(us,{value:ae,onChange:t=>ze(t.target.value),placeholder:"Explain why this exchange works for you...",color:u,resize:"vertical",rows:3})]})]}),e.jsxs(S,{justify:"flex-end",mt:6,gap:3,children:[e.jsx(y,{variant:"ghost",onClick:()=>ee(!1),children:"Cancel"}),e.jsx(y,{type:"button",colorScheme:"green",isDisabled:!ae.trim()||De,isLoading:De,onClick:Ds,children:"Submit Application"})]})]})]})]}),e.jsxs(ce,{isOpen:vs,onClose:()=>se(!1),size:"xl",children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(5px)"}),e.jsxs(de,{bg:k,borderRadius:"xl",children:[e.jsx(J,{color:u,children:"Applications for Your Request"}),e.jsx(ue,{}),e.jsx(Z,{children:re.length>0?e.jsx(D,{spacing:4,align:"stretch",children:re.map(t=>{var a;return e.jsxs(He,{p:4,borderRadius:"md",borderWidth:"1px",borderColor:i,position:"relative",children:[t.status!=="pending"&&e.jsx(xe,{position:"absolute",top:2,right:2,colorScheme:t.status==="accepted"?"green":"red",variant:"solid",borderRadius:"md",px:2,textTransform:"capitalize",fontSize:"xs",children:t.status}),e.jsxs(S,{mb:3,children:[e.jsx(Le,{size:"sm",src:t.userAvatar,name:(a=t.user)==null?void 0:a.name,mr:3}),e.jsxs(D,{align:"start",spacing:0,children:[e.jsx(o,{fontWeight:"medium",color:u,children:t.userName}),e.jsxs(o,{fontSize:"xs",color:P,children:["Applied: ",new Date(t.createdAt).toLocaleDateString()]})]})]}),e.jsx(C,{p:3,bg:A("gray.50","gray.700"),borderRadius:"md",mb:3,children:e.jsx(o,{fontSize:"sm",color:P,children:t.reason})}),t.status==="pending"&&e.jsxs(S,{justifyContent:"flex-end",gap:2,children:[e.jsx(y,{size:"sm",colorScheme:"green",onClick:()=>Ts(t.id),children:"Accept"}),e.jsx(y,{size:"sm",colorScheme:"red",variant:"outline",onClick:()=>Fs(t.id),children:"Decline"})]})]},t.id)})}):e.jsx(C,{p:8,textAlign:"center",borderWidth:"2px",borderStyle:"dashed",borderColor:i,borderRadius:"lg",children:e.jsx(o,{color:P,children:"No applications received yet"})})}),e.jsx(Ee,{children:e.jsx(y,{onClick:()=>se(!1),children:"Close"})})]})]})]})});function ys({isOpen:s,onClose:c,mode:x="create",initialData:p={},onSubmit:M,courses:d=[],coursesLoading:f=!1,coursesError:j=null,coursesPage:T=1,coursesTotalPages:F=1,onCoursePageChange:n}){var k,u,P,O;const b={id:"",courseName:"",currentSection:"",desiredSection:"",currentDay:"",currentTime:"",desiredDay:"",desiredTime:"",reason:""},[l,_]=r.useState({...b,...p}),[w,R]=r.useState(!1);r.useEffect(()=>{_({...b,...p})},[p]);const v=i=>{const{name:E,value:Y}=i.target;_(V=>({...V,[E]:Y}))},g=async i=>{i.preventDefault(),R(!0);try{await M(l)}catch{}finally{R(!1)}};return e.jsxs(ce,{isOpen:s,onClose:c,size:"lg",children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(5px)"}),e.jsxs(de,{borderRadius:"xl",children:[e.jsx(J,{children:x==="edit"?"Edit Exchange Request":"Create Exchange Request"}),e.jsx(ue,{}),e.jsxs(Z,{children:[e.jsxs(Is,{status:"info",variant:"left-accent",mb:4,borderRadius:"md",children:[e.jsx(Bs,{}),e.jsx(o,{fontSize:"sm",children:"You can only make up to 2 exchange requests per day."})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs(ds,{spacing:4,children:[e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Course"}),e.jsxs(Ie,{isLazy:!0,children:[e.jsx(Be,{as:y,w:"100%",rightIcon:e.jsx("span",{style:{marginLeft:8},children:"▼"}),isLoading:f,isDisabled:f,variant:"outline",textAlign:"left",children:l.courseName?(k=d.find(i=>(i.code||i.name)===l.courseName))!=null&&k.code?`${(u=d.find(i=>(i.code||i.name)===l.courseName))==null?void 0:u.code} - ${(P=d.find(i=>(i.code||i.name)===l.courseName))==null?void 0:P.title}`:(O=d.find(i=>(i.code||i.name)===l.courseName))==null?void 0:O.name:f?"Loading courses...":"Select course"}),e.jsxs(Ye,{maxH:"320px",overflowY:"auto",minW:"320px",px:0,children:[j&&e.jsx(C,{px:4,py:2,children:e.jsx(o,{color:"red.500",fontSize:"sm",children:j})}),f?e.jsx(C,{px:4,py:2,children:e.jsx(o,{fontSize:"sm",children:"Loading..."})}):d.length===0?e.jsx(C,{px:4,py:2,children:e.jsx(o,{fontSize:"sm",color:"gray.500",children:"No courses found."})}):d.map(i=>e.jsx(B,{value:i.code||i.name,onClick:()=>_(E=>({...E,courseName:i.code||i.name})),bg:(i.code||i.name)===l.courseName?"blue.50":void 0,fontWeight:(i.code||i.name)===l.courseName?"bold":"normal",children:i.code?`${i.code} - ${i.title}`:i.name},i.id||i.code)),e.jsx(C,{borderTop:"1px solid",borderColor:"gray.100",mt:2,px:2,py:1,children:e.jsx($e,{currentPage:T,totalPages:F,onPageChange:n,isLoading:f})})]})]})]}),e.jsxs($,{templateColumns:"repeat(2, 1fr)",gap:4,children:[e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Current Section"}),e.jsx(ie,{name:"currentSection",value:l.currentSection,onChange:v,placeholder:"e.g., A, B, C"})]}),e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Desired Section"}),e.jsx(ie,{name:"desiredSection",value:l.desiredSection,onChange:v,placeholder:"e.g., B, C, D"})]})]}),e.jsxs($,{templateColumns:"repeat(2, 1fr)",gap:4,children:[e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Current Day"}),e.jsxs(me,{name:"currentDay",value:l.currentDay,onChange:v,placeholder:"Select day",children:[e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"})]})]}),e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Current Time"}),e.jsx(ie,{name:"currentTime",value:l.currentTime,onChange:v,type:"time"})]})]}),e.jsxs($,{templateColumns:"repeat(2, 1fr)",gap:4,children:[e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Desired Day"}),e.jsxs(me,{name:"desiredDay",value:l.desiredDay,onChange:v,placeholder:"Select day",children:[e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"})]})]}),e.jsxs(q,{isRequired:!0,children:[e.jsx(W,{children:"Desired Time"}),e.jsx(ie,{name:"desiredTime",value:l.desiredTime,onChange:v,type:"time"})]})]}),e.jsxs(q,{children:[e.jsx(W,{children:"Reason (Optional)"}),e.jsx(us,{name:"reason",value:l.reason,onChange:v,placeholder:"Explain why you need to exchange class times...",resize:"vertical",rows:2})]})]}),e.jsxs(S,{justify:"flex-end",mt:6,gap:3,children:[e.jsx(y,{variant:"ghost",onClick:c,children:"Cancel"}),e.jsx(y,{type:"submit",colorScheme:x==="edit"?"blue":"yellow",isLoading:w,children:x==="edit"?"Update":"Create Request"})]})]})]})]})]})}function _t(s){const c=r.useRef(),x=cs(),{courses:p,coursesLoading:M,coursesError:d,coursesPage:f,coursesTotalPages:j,setCoursesPage:T}=gs({trigger:s.editRequestModalOpen}),[F,n]=r.useState(!1),[b,l]=r.useState(null),[_,w]=r.useState(!1),R=g=>{l(g),n(!0)},v=async g=>{w(!0);try{const k={course_name:g.courseName,current_section:g.currentSection,desired_section:g.desiredSection,current_day:g.currentDay,desired_day:g.desiredDay,current_time:g.currentTime,desired_time:g.desiredTime,reason:g.reason};await ps(g.id,k),n(!1),l(null),c.current&&(c.current.fetchAvailableRequestsPaginated(),c.current.fetchMyRequestsPaginated()),x({title:"Request updated",status:"success",duration:3e3,isClosable:!0})}catch(k){x({title:"Failed to update request",description:k.message,status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(xt,{ref:c,onEditRequest:R}),e.jsx(ys,{isOpen:F,onClose:()=>n(!1),mode:"edit",initialData:b||{},onSubmit:v,isLoading:_,courses:p,coursesLoading:M,coursesError:d,coursesPage:f,coursesTotalPages:j,onCoursePageChange:T})]})}export{_t as default};
