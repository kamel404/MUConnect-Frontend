const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/resourceService-BPsVWu4e.js","assets/index-Dge-MEAl.js","assets/chakra-BFMGxYLr.js","assets/react-6s1XWRBU.js"])))=>i.map(i=>d[i]);
import{T as Ss,U as Cs,V as De,W as Es,X as _s,Y as As,B as Be,Z as Me,u as zs,O as $s,A as Ws,$ as Os,S as Ds,a0 as Bs,y as hs,_ as Ls,q as xs}from"./index-Dge-MEAl.js";import{j as e,V,B as x,u as h,a6 as be,H as Y,am as oe,a8 as Is,d,F as _,I as X,S as gs,n as Ve,c as q,M as Le,e as qe,f as He,g as xe,an as qs,ao as $e,ap as We,aq as Oe,ar as ss,h as rs,K as is,T as Hs,m as ns,as as Ns,at as Vs,A as ms,ai as ls,x as as,aj as cs,ak as ds,z as us,E as ps,D as Re,$ as ks,au as _e,O as fs,av as bs,U as Rs,W as Ae,X as ze,R as Ne,a9 as Ys,al as js,Q as Us,Y as Gs,aa as Xs}from"./chakra-BFMGxYLr.js";import{a as o,u as Ms,b as Ps}from"./react-6s1XWRBU.js";import{R as ys}from"./ResourceCard-Bf06nQaY.js";import{getTopContributors as Js,updateResource as Qs,getAllResources as Zs,toggleSaveResource as Ks,toggleUpvote as et,createResource as st}from"./resourceService-BPsVWu4e.js";import{a as ts,l as Ie,c as ke}from"./errorHandler-C4MeMDhB.js";import{f as vs}from"./courseService-3S11OU7p.js";import"./slick-theme-DqLTtZqT.js";const tt=({resources:s,onBookmark:y,onUpvote:z,currentUser:R,onShare:v,onAddComment:i,onFollow:u,onCardClick:b,onEdit:$,onDelete:O,cardBg:S,textColor:f,mutedText:F,borderColor:K,isLoading:D,feedType:M})=>{if(D)return e.jsx(V,{spacing:6,align:"stretch",w:"full",children:[1,2,3].map(w=>e.jsxs(x,{as:be.div,initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{delay:w*.1}},bg:h("rgba(255, 255, 255, 0.7)","rgba(45, 55, 72, 0.7)"),backdropFilter:"blur(10px)",borderRadius:"24px",borderWidth:"1px",borderColor:h("brand.navy","rgba(74, 85, 104, 0.3)"),p:6,w:"full",overflow:"hidden",boxShadow:"0 10px 30px -15px rgba(0, 0, 0, 0.1)",children:[e.jsxs(Y,{mb:4,children:[e.jsx(oe,{height:"40px",width:"40px",borderRadius:"full"}),e.jsxs(V,{align:"start",spacing:2,flex:1,children:[e.jsx(oe,{height:"10px",width:"120px"}),e.jsx(oe,{height:"8px",width:"80px"})]})]}),e.jsx(oe,{height:"16px",width:"70%",mb:4}),e.jsx(oe,{height:"12px",width:"90%",mb:2}),e.jsx(oe,{height:"12px",width:"60%",mb:4}),e.jsx(oe,{height:"200px",width:"100%",borderRadius:"xl",mb:4}),e.jsxs(Y,{spacing:4,justify:"space-between",children:[e.jsxs(Y,{children:[e.jsx(oe,{height:"30px",width:"30px",borderRadius:"full"}),e.jsx(oe,{height:"30px",width:"30px",borderRadius:"full"}),e.jsx(oe,{height:"30px",width:"30px",borderRadius:"full"})]}),e.jsx(oe,{height:"10px",width:"60px"})]})]},w))});const p={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1,duration:.5}}},W={hidden:{opacity:0,y:20,scale:.98},show:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:260,damping:20,duration:.5}}},ee=M==="grid"?e.jsx(x,{w:"full",position:"relative",as:be.div,variants:p,initial:"hidden",animate:"show",children:e.jsx(Is,{columns:{base:1,sm:2,lg:3},spacing:"20px",children:s&&s.map((w,A)=>e.jsx(x,{as:be.div,variants:W,gridRow:A%5===0?"span 2":"span 1",gridColumn:A%7===0?"span 2":"span 1",zIndex:100-A,transformOrigin:"center",children:e.jsx(ys,{resource:w,onBookmark:y,onUpvote:z,currentUser:R,onCardClick:b,onEdit:$,onDelete:O,onShare:v,onAddComment:i,onFollow:u,cardBg:S,textColor:f,mutedText:F,borderColor:K})},w.id))})}):e.jsx(V,{spacing:8,align:"stretch",w:"full",as:be.div,variants:p,initial:"hidden",animate:"show",children:s&&s.map((w,A)=>e.jsx(x,{as:be.div,variants:W,transformOrigin:"center",children:e.jsx(ys,{resource:w,onBookmark:y,onUpvote:z,currentUser:R,onCardClick:b,onEdit:$,onDelete:O,onAddComment:i,onFollow:u,cardBg:S,textColor:f,mutedText:F,borderColor:K})},w.id))});return e.jsx(x,{w:"full",children:D?e.jsx(x,{}):s&&s.length>0?ee:e.jsx(x,{p:12,textAlign:"center",borderWidth:"2px",borderStyle:"dashed",borderColor:h("rgba(226, 232, 240, 0.8)","rgba(74, 85, 104, 0.3)"),borderRadius:"2xl",bg:h("rgba(255, 255, 255, 0.6)","rgba(45, 55, 72, 0.6)"),backdropFilter:"blur(8px)",boxShadow:"0px 4px 16px rgba(0, 0, 0, 0.05)",as:be.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(V,{spacing:4,children:[e.jsx(x,{p:4,borderRadius:"full",bg:h("gray.50","gray.700"),boxShadow:"inner",children:e.jsx(Ss,{size:30,color:h("#A0AEC0","#718096")})}),e.jsx(d,{color:F,fontSize:"lg",children:"No resources found matching your filters"}),e.jsx(d,{color:F,fontSize:"sm",children:"Try adjusting your search or filters"})]})})})},ot=({searchQuery:s,facultyFilter:y,setFacultyFilter:z,courseFilter:R,setCourseFilter:v,majorFilter:i,setMajorFilter:u,faculties:b,majors:$,courses:O,coursePagination:S,onCoursePageChange:f,isLoadingFilters:F,onClearFilters:K,mutedText:D})=>{h("blue.50","blue.900"),h("blue.100","blue.800"),h("gray.100","gray.700");const M=s!==""||y!=="All"||R!=="All"||i!=="All",p=w=>{var A;return((A=b.find(U=>U.id===w))==null?void 0:A.name)||"Faculty"},W=w=>{var A;return((A=$.find(U=>U.id===w))==null?void 0:A.name)||"Major"},ee=w=>{var A;return((A=O.find(U=>U.id===w))==null?void 0:A.title)||"Course"};return e.jsxs(_,{direction:"column",w:"full",gap:3,children:[e.jsxs(_,{justify:"space-between",align:"center",w:"full",mb:2,children:[e.jsxs(Y,{children:[e.jsx(X,{as:Cs}),e.jsx(d,{fontWeight:"medium",children:"Filters"}),F&&e.jsx(gs,{size:"sm",ml:2}),M&&!F&&e.jsx(Ve,{ml:1,colorScheme:"blue",borderRadius:"full",px:2,children:(s?1:0)+(y!=="All"?1:0)+(R!=="All"?1:0)+(i!=="All"?1:0)})]}),M&&e.jsx(q,{size:"xs",variant:"ghost",colorScheme:"blue",onClick:K,children:"Clear All"})]}),e.jsxs(_,{direction:{base:"column",md:"row"},gap:3,mb:2,children:[e.jsxs(Le,{children:[e.jsx(qe,{as:q,rightIcon:e.jsx(De,{}),w:"full",isDisabled:F,children:y==="All"?"Faculty":p(y)}),e.jsxs(He,{children:[e.jsx(xe,{onClick:()=>z("All"),children:"All Faculties"}),b&&b.map(w=>e.jsx(xe,{onClick:()=>z(w.id),children:w.name},w.id))]})]}),e.jsxs(Le,{children:[e.jsx(qe,{as:q,rightIcon:e.jsx(De,{}),w:"full",isDisabled:F||y==="All",children:i==="All"?"Major":W(i)}),e.jsxs(He,{children:[e.jsx(xe,{onClick:()=>u("All"),children:"All Majors"}),$&&$.map(w=>e.jsx(xe,{onClick:()=>u(w.id),children:w.name},w.id))]})]}),e.jsxs(Le,{children:[e.jsx(qe,{as:q,rightIcon:e.jsx(De,{}),w:"full",isDisabled:F||i==="All",children:R==="All"?"Course":ee(R)}),e.jsxs(He,{children:[e.jsx(xe,{onClick:()=>v("All"),children:"All Courses"}),O&&O.map(w=>e.jsx(xe,{onClick:()=>v(w.id),children:w.title},w.id)),S&&S.last_page>1&&e.jsx(x,{px:3,py:2,children:e.jsxs(_,{justify:"space-between",align:"center",children:[e.jsx(q,{size:"sm",onClick:()=>f(S.current_page-1),isDisabled:S.current_page===1,children:"Prev"}),e.jsxs(d,{fontSize:"sm",children:["Page ",S.current_page," of ",S.last_page]}),e.jsx(q,{size:"sm",onClick:()=>f(S.current_page+1),isDisabled:S.current_page===S.last_page,children:"Next"})]})})]})]})]}),M&&e.jsx(x,{mt:3,children:e.jsxs(qs,{spacing:2,children:[y!=="All"&&e.jsx($e,{children:e.jsxs(We,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"green",children:[e.jsx(Oe,{children:e.jsxs(Y,{spacing:1,children:[e.jsx(d,{fontSize:"xs",children:"Faculty:"}),e.jsx(d,{fontSize:"sm",fontWeight:"medium",children:p(y)})]})}),e.jsx(ss,{onClick:()=>z("All")})]})}),i!=="All"&&e.jsx($e,{children:e.jsxs(We,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"purple",children:[e.jsx(Oe,{children:e.jsxs(Y,{spacing:1,children:[e.jsx(d,{fontSize:"xs",children:"Major:"}),e.jsx(d,{fontSize:"sm",fontWeight:"medium",children:W(i)})]})}),e.jsx(ss,{onClick:()=>u("All")})]})}),R!=="All"&&e.jsx($e,{children:e.jsxs(We,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"orange",children:[e.jsx(Oe,{children:e.jsxs(Y,{spacing:1,children:[e.jsx(d,{fontSize:"xs",children:"Course:"}),e.jsx(d,{fontSize:"sm",fontWeight:"medium",children:ee(R)})]})}),e.jsx(ss,{onClick:()=>v("All")})]})}),s&&e.jsx($e,{children:e.jsx(We,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"purple",children:e.jsx(Oe,{children:e.jsxs(Y,{spacing:1,children:[e.jsx(d,{fontSize:"xs",children:"Search:"}),e.jsxs(d,{fontSize:"sm",fontWeight:"medium",children:['"',s,'"']})]})})})})]})})]})},rt=({limit:s})=>{const[y,z]=o.useState([]),[R,v]=o.useState(!0),[i,u]=o.useState(null);Ms();const{isOpen:b,onOpen:$,onClose:O}=rs(),S=h("white","gray.800"),f=h("brand.navy","gray.700"),F=h("brand.navy","blue.300"),K=h("gray.700","gray.300"),D=h("linear-gradient(to bottom, white, blue.50)","linear-gradient(to bottom, gray.800, gray.900)");return o.useEffect(()=>{(async()=>{v(!0);try{const W=(await Js(s)).data||[];z(W)}catch(p){console.error("Error fetching top contributors:",p),u("Failed to load top contributors")}finally{v(!1)}})()},[s]),i?e.jsxs(x,{p:4,bg:S,borderRadius:"md",boxShadow:"sm",border:"1px",borderColor:f,children:[e.jsx(is,{size:"sm",mb:3,color:"red.500",children:"Error"}),e.jsx(d,{fontSize:"sm",children:i})]}):e.jsxs(x,{p:4,bg:D,borderRadius:"lg",boxShadow:"md",border:"1px",borderColor:f,position:"sticky",top:"20px",children:[e.jsxs(_,{align:"center",justify:"center",mb:4,gap:2,children:[e.jsx(is,{size:"md",color:F,children:"Top Contributors"}),e.jsx(Hs,{label:"How scoring works",children:e.jsx(ns,{icon:e.jsx(Es,{}),size:"sm",variant:"ghost",colorScheme:"blue",onClick:$,"aria-label":"Contribution scoring info"})})]}),R?e.jsx(V,{spacing:4,align:"stretch",children:[...Array(s)].map((M,p)=>e.jsxs(Y,{spacing:3,children:[e.jsx(Ns,{size:"10"}),e.jsx(x,{flex:"1",children:e.jsx(Vs,{noOfLines:2,spacing:"2"})})]},p))}):e.jsx(V,{spacing:3,align:"stretch",children:y.length===0?e.jsx(d,{fontSize:"sm",textAlign:"center",color:K,children:"No contributors found"}):y.map((M,p)=>e.jsxs(x,{p:3,borderRadius:"md",bg:p===0?"yellow.100":p===1?"gray.100":p===2?"orange.100":"transparent",_dark:{bg:p===0?"yellow.900":p===1?"gray.700":p===2?"orange.900":"transparent"},_hover:{transform:"translateY(-2px)",transition:"transform 0.2s"},children:[e.jsxs(Y,{spacing:3,children:[e.jsx(ms,{size:"sm",name:`${M.first_name} ${M.last_name}`,src:M.avatar_url,border:p<3?"2px solid":"none",borderColor:p===0?"yellow.500":p===1?"gray.400":p===2?"orange.500":"transparent"}),e.jsxs(V,{spacing:1,align:"start",flex:"1",children:[e.jsxs(Y,{children:[e.jsxs(d,{fontWeight:"medium",fontSize:"sm",children:[M.first_name," ",M.last_name]}),p<3&&e.jsxs(Ve,{colorScheme:p===0?"yellow":p===1?"gray":"orange",variant:"solid",fontSize:"xs",children:["#",p+1]})]}),e.jsx(d,{fontSize:"xs",color:"gray.500",_dark:{color:"gray.400"},children:M.major_name?` ${M.major_name}`:""})]})]}),e.jsx(Y,{mt:2,spacing:4,fontSize:"xs",color:"gray.500",children:e.jsxs(Ve,{colorScheme:"blue",variant:"outline",ml:"auto",children:["Score: ",M.contribution_score]})})]},M.id))}),e.jsxs(ls,{isOpen:b,onClose:O,size:"lg",children:[e.jsx(as,{}),e.jsxs(cs,{children:[e.jsx(ds,{color:F,children:"ðŸ† Contribution Scoring System"}),e.jsx(us,{}),e.jsx(ps,{pb:6,children:e.jsxs(V,{align:"stretch",spacing:4,children:[e.jsxs(x,{children:[e.jsx(d,{fontWeight:"bold",mb:3,children:"How Points Are Earned:"}),e.jsxs(V,{align:"stretch",spacing:0,children:[e.jsxs(_,{justify:"space-between",py:2,children:[e.jsx(d,{children:"Approved Resource"}),e.jsx(d,{fontWeight:"bold",color:"blue.500",children:"+5 pts"})]}),e.jsx(Re,{}),e.jsxs(_,{justify:"space-between",py:2,children:[e.jsx(d,{children:"Resource Upvote"}),e.jsx(d,{fontWeight:"bold",color:"blue.500",children:"+3 pts"})]}),e.jsx(Re,{}),e.jsxs(_,{justify:"space-between",py:2,children:[e.jsx(d,{children:"Comment Posted"}),e.jsx(d,{fontWeight:"bold",color:"blue.500",children:"+2 pts"})]}),e.jsx(Re,{}),e.jsxs(_,{justify:"space-between",py:2,children:[e.jsx(d,{children:"Comment Upvote"}),e.jsx(d,{fontWeight:"bold",color:"blue.500",children:"+1 pt"})]}),e.jsx(Re,{}),e.jsxs(_,{justify:"space-between",py:2,children:[e.jsx(d,{children:"Profile Upvote"}),e.jsx(d,{fontWeight:"bold",color:"blue.500",children:"+5 pts"})]})]})]}),e.jsxs(x,{children:[e.jsx(d,{fontWeight:"bold",mb:2,children:"ðŸ’¡ Tips to Rank Higher:"}),e.jsxs(V,{align:"stretch",spacing:1,fontSize:"sm",children:[e.jsxs(d,{children:["â€¢ ",e.jsx("b",{children:"Share"})," high-quality, helpful resources"]}),e.jsxs(d,{children:["â€¢ ",e.jsx("b",{children:"Engage"})," with the community through comments"]}),e.jsxs(d,{children:["â€¢ ",e.jsx("b",{children:"Build"})," your reputation with valuable contributions"]})]})]}),e.jsx(x,{bg:"blue.50",_dark:{bg:"blue.900"},p:3,borderRadius:"md",children:e.jsx(d,{fontSize:"sm",textAlign:"center",children:"The best contributors combine quality content with active community engagement! ðŸŒŸ"})})]})})]})]})]})},it=({handleImageUpload:s,handleVideoUpload:y,handleDocumentUpload:z,handlePollAdd:R})=>{const v=o.useRef(null),i=o.useRef(null),u=o.useRef(null),b=h("gray.200","gray.600"),$=h("gray.50","gray.700");h("blue.500","blue.200");const O=[{type:"images",icon:_s,label:"Photo",ref:v,accept:"image/*",handler:s},{type:"videos",icon:As,label:"Video",ref:i,accept:"video/*",handler:y},{type:"documents",icon:Be,label:"Document",ref:u,accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx",handler:z},{type:"poll",icon:Me,label:"Poll",handler:R}];return e.jsxs(e.Fragment,{children:[e.jsx(Re,{my:4,borderColor:b}),e.jsx(Y,{spacing:2,justify:"space-between",children:e.jsx(_,{children:O.map(S=>e.jsx(Ps.Fragment,{children:S.ref?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:"sm",leftIcon:e.jsx(X,{as:S.icon}),variant:"ghost",colorScheme:"blue",onClick:()=>{var f;return(f=S.ref.current)==null?void 0:f.click()},_hover:{bg:$},px:3,children:S.label}),e.jsx("input",{type:"file",multiple:!0,hidden:!0,ref:S.ref,accept:S.accept,onChange:S.handler})]}):e.jsx(q,{size:"sm",leftIcon:e.jsx(X,{as:S.icon}),variant:"ghost",colorScheme:"blue",onClick:S.handler,_hover:{bg:$},px:3,children:S.label})},S.type))})})]})},je=s=>{const y=s.images||[],z=s.videos||[],R=s.documents||[],v=s.polls||[];return[...y.map(u=>({...u,mediaType:"image"})),...z.map(u=>({...u,mediaType:"video"})),...R.map(u=>({...u,mediaType:"document"})),...v.map(u=>({...u,mediaType:"poll"}))].sort((u,b)=>{if(!u.id||!b.id)return 0;let $=0,O=0;try{typeof u.id=="string"&&u.id.includes("-")&&($=parseInt(u.id.split("-")[1])||0),typeof b.id=="string"&&b.id.includes("-")&&(O=parseInt(b.id.split("-")[1])||0)}catch(S){console.error("Error parsing attachment ID:",S)}return O-$})},ws=s=>s<1024?s+" B":s<1048576?(s/1024).toFixed(1)+" KB":(s/1048576).toFixed(1)+" MB",nt=({attachments:s,removeAttachment:y})=>{const z=h("gray.200","gray.600"),R=h("gray.50","gray.700"),v=Ps.useMemo(()=>{var u;return[s.images.length>0,s.videos.length>0,s.documents.length>0,((u=s.polls)==null?void 0:u.length)>0].filter(Boolean).length>1},[s]);return s.images.length===0&&s.videos.length===0&&s.documents.length===0&&(!s.polls||s.polls.length===0)?null:e.jsxs(x,{borderWidth:"1px",borderRadius:"lg",p:3,borderColor:z,bg:R,children:[e.jsxs(_,{justify:"space-between",align:"center",mb:2,children:[e.jsx(d,{fontSize:"sm",fontWeight:"medium",children:"Attachments:"}),v&&e.jsx(Ve,{colorScheme:"purple",px:2,py:1,borderRadius:"full",fontSize:"xs",children:"Mixed Content"})]}),v&&e.jsxs(_,{mb:3,gap:3,justify:"flex-start",children:[s.images.length>0&&e.jsxs(_,{align:"center",gap:1,children:[e.jsx(X,{as:_s,color:"green.500"}),e.jsxs(d,{fontSize:"xs",children:[s.images.length," image",s.images.length!==1?"s":""]})]}),s.videos.length>0&&e.jsxs(_,{align:"center",gap:1,children:[e.jsx(X,{as:As,color:"red.500"}),e.jsxs(d,{fontSize:"xs",children:[s.videos.length," video",s.videos.length!==1?"s":""]})]}),s.documents.length>0&&e.jsxs(_,{align:"center",gap:1,children:[e.jsx(X,{as:Be,color:"blue.500"}),e.jsxs(d,{fontSize:"xs",children:[s.documents.length," document",s.documents.length!==1?"s":""]})]}),s.polls&&s.polls.length>0&&e.jsxs(_,{align:"center",gap:1,children:[e.jsx(X,{as:Me,color:"teal.500"}),e.jsxs(d,{fontSize:"xs",children:[s.polls.length," poll",s.polls.length!==1?"s":""]})]})]}),je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls}).length>0&&e.jsx(x,{children:je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls}).length===1?e.jsxs(x,{position:"relative",borderRadius:"md",overflow:"hidden",children:[(()=>{const i=je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls})[0];if(i.mediaType==="poll")return e.jsxs(x,{p:4,bg:"blackAlpha.50",borderRadius:"md",children:[e.jsx(_,{justifyContent:"space-between",alignItems:"flex-start",mb:3,children:e.jsxs(_,{alignItems:"center",gap:2,children:[e.jsx(X,{as:Me,color:"teal.500"}),e.jsx(d,{fontWeight:"semibold",children:i.question})]})}),e.jsx(V,{spacing:3,align:"stretch",children:i.options.map((u,b)=>e.jsxs(x,{borderRadius:"md",borderWidth:"1px",p:2,children:[e.jsx(d,{fontSize:"sm",mb:1,children:u.text}),e.jsx(ks,{value:0,size:"sm",colorScheme:"teal",borderRadius:"full"})]},u.id))})]});if(i.mediaType==="video")return e.jsx(_e,{ratio:16/9,children:e.jsx(x,{as:"video",src:i.url,controls:!0,borderRadius:"md"})});if(i.mediaType==="image")return e.jsx(_e,{ratio:4/3,children:e.jsx(fs,{src:i.url,alt:i.name,borderRadius:"md",objectFit:"cover"})});if(i.mediaType==="document")return e.jsx(_,{p:4,borderRadius:"md",bg:"blackAlpha.50",align:"center",justify:"space-between",height:"100px",children:e.jsxs(_,{align:"center",children:[e.jsx(X,{as:Be,boxSize:10,mr:3,color:"blue.500"}),e.jsxs(x,{children:[e.jsx(d,{fontSize:"md",fontWeight:"medium",noOfLines:1,children:i.name}),e.jsx(d,{fontSize:"sm",color:"gray.500",children:ws(i.size)})]})]})})})(),e.jsx(bs,{position:"absolute",top:1,right:1,size:"sm",bg:"blackAlpha.700",color:"white",onClick:()=>{const i=je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls})[0],u=i.mediaType==="image"?"images":i.mediaType==="video"?"videos":i.mediaType==="poll"?"polls":"documents";y(u,i.id)},_hover:{bg:"blackAlpha.800"}})]}):e.jsx(Is,{columns:Math.min(je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls}).length,3),spacing:2,children:je({images:s.images,videos:s.videos,documents:s.documents,polls:s.polls}).map(i=>e.jsxs(x,{position:"relative",borderRadius:"md",overflow:"hidden",children:[i.mediaType==="poll"?e.jsxs(x,{p:3,bg:"blackAlpha.50",borderRadius:"md",height:"100%",children:[e.jsx(_,{justifyContent:"space-between",alignItems:"flex-start",mb:2,children:e.jsxs(_,{alignItems:"center",gap:1,children:[e.jsx(X,{as:Me,color:"teal.500",boxSize:4}),e.jsx(d,{fontWeight:"semibold",fontSize:"sm",noOfLines:1,children:i.question})]})}),e.jsxs(d,{fontSize:"xs",color:"gray.500",children:[i.options.length," options"]})]}):i.mediaType==="video"?e.jsx(_e,{ratio:1,children:e.jsx(x,{as:"video",src:i.url,controls:!0,borderRadius:"md"})}):i.mediaType==="image"?e.jsx(_e,{ratio:1,children:e.jsx(fs,{src:i.url,alt:i.name,borderRadius:"md",objectFit:"cover"})}):e.jsx(_e,{ratio:1,children:e.jsxs(_,{direction:"column",p:3,bg:"blackAlpha.50",align:"center",justify:"center",borderRadius:"md",height:"100%",width:"100%",children:[e.jsx(X,{as:Be,boxSize:10,mb:2,color:"blue.500"}),e.jsx(d,{fontSize:"sm",fontWeight:"medium",noOfLines:1,textAlign:"center",children:i.name}),e.jsx(d,{fontSize:"xs",color:"gray.500",children:ws(i.size)})]})}),e.jsx(bs,{position:"absolute",top:1,right:1,size:"sm",bg:"blackAlpha.700",color:"white",onClick:()=>{const u=i.mediaType==="image"?"images":i.mediaType==="video"?"videos":"documents";y(u,i.id)},_hover:{bg:"blackAlpha.800"}})]},i.id))})})]})},os=s=>new Promise((y,z)=>{const R=new FileReader;R.readAsDataURL(s),R.onload=()=>y(R.result),R.onerror=v=>z(v)}),lt=({isOpen:s,onClose:y,addNewPost:z,updateResource:R,editResource:v,user:i})=>{var I,k;const{user:u}=zs(),b=i||u,$=h("blue.500","blue.200"),O=h("gray.200","gray.600");h("gray.50","gray.700");const S=h("blue.500","blue.200"),f=Rs(),[F,K]=o.useState(""),[D,M]=o.useState(""),[p,W]=o.useState(""),[ee,w]=o.useState(!1),[A,U]=o.useState(""),[ue,ye]=o.useState(""),[ne,ve]=o.useState(""),[Ye,Pe]=o.useState(""),[Ue,re]=o.useState(!1),[pe,we]=o.useState([]),[fe,he]=o.useState(!1),[ge,le]=o.useState(1),[H,E]=o.useState(1),[J,me]=o.useState(!1),[de,Fe]=o.useState(""),[Q,ae]=o.useState(["",""]),[Se,Ce]=o.useState(!1),[se,Z]=o.useState({images:[],videos:[],documents:[],polls:[]}),[G,ce]=o.useState([]),[te,Te]=o.useState([]),ie=o.useMemo(()=>[se.images.length>0,se.videos.length>0,se.documents.length>0,se.polls.length>0].filter(Boolean).length>1,[se]);o.useRef(null),o.useEffect(()=>{if(v&&s){if(w(!0),K(v.title||""),M(v.description||""),v.attachments&&Array.isArray(v.attachments)){const t={images:[],videos:[],documents:[],polls:[]};v.attachments.forEach(r=>{const l=r.url?`${$s}${r.url}`:`${Ws}/storage/${r.file_path}`,g={id:r.id,url:l,name:r.original_name||"File",preview:l};switch(r.file_type){case"image":t.images.push(g);break;case"video":t.videos.push(g);break;case"document":t.documents.push(g);break}}),Z(t)}}else w(!1),K(""),M(""),W(""),U(""),ye(""),ve(""),Pe(""),Z({images:[],videos:[],documents:[],polls:[]}),ce([])},[v,s]),o.useRef(null),o.useRef(null),o.useEffect(()=>{s&&(async(r=1)=>{var l,g;he(!0);try{const m=localStorage.getItem("major_id"),N=localStorage.getItem("faculty_id"),C={...m?{major_id:m}:N?{faculty_id:N}:{},page:r,per_page:10},n=await vs(C);we(n.data||[]),le(n.current_page||1),E(n.last_page||1)}catch(m){f({title:"Failed to fetch courses",description:((g=(l=m.response)==null?void 0:l.data)==null?void 0:g.message)||m.message||"Unknown error",status:"error",duration:4e3,isClosable:!0})}finally{he(!1)}})(1)},[s]);const Ee=async t=>{var r,l;if(!(t<1||t>H)){he(!0);try{const g=localStorage.getItem("major_id"),m=localStorage.getItem("faculty_id"),N={...g?{major_id:g}:m?{faculty_id:m}:{},page:t,per_page:10},C=await vs(N);we(C.data||[]),le(C.current_page||t),E(C.last_page||1)}catch(g){f({title:"Failed to fetch courses",description:((l=(r=g.response)==null?void 0:r.data)==null?void 0:l.message)||g.message||"Unknown error",status:"error",duration:4e3,isClosable:!0})}finally{he(!1)}}},Ge=()=>{K(""),M(""),W(""),U(""),ye(""),ve(""),Pe(""),Fe(""),ae(["",""]),Ce(!1),Z({images:[],videos:[],documents:[],polls:[]}),ce([])},Xe=async()=>{var t,r,l,g,m,N;if(!F.trim()){f({title:"Title required",description:"Please add a title for your post",status:"error",duration:3e3,isClosable:!0});return}re(!0);try{const C={};if(C.content=D,C.title=F,C.type=p||"Default",!p&&ie?C.type="Mixed Content":se.images.length>0&&!p&&!ie||se.videos.length>0&&!p&&!ie?C.type="Media":se.documents.length>0&&!p&&!ie?C.type="Course Material":se.polls.length>0&&!p&&!ie&&(C.type="Poll"),ee&&v)try{console.log("Updating resource with ID:",v.id);const n=new FormData;if(F.trim()&&n.append("title",F.trim()),D.trim()&&n.append("description",D.trim()),G&&G.length>0?(console.log(`Adding ${G.length} new attachment(s)`),console.log("Attachment files to add:",G),G.forEach(P=>{n.append("attachments[]",P),console.log("Added file to form data:",P.name)})):console.log("No new attachment files to add"),te&&te.length>0&&(console.log(`Removing ${te.length} attachment(s):`,te),te.forEach(P=>{n.append("remove_attachments[]",P)})),console.log("Resource ID for update:",v.id),!v.id)throw new Error("Cannot update resource: Missing resource ID");if(typeof R=="function"){const P={id:v.id,title:F.trim(),description:D.trim(),newAttachments:G,removeAttachmentIds:te};console.log("[CreatePostModal.jsx] Calling props.updateResource with:",JSON.stringify(P,(B,L)=>L instanceof File?L.name:L,2)),await R(P)}else console.log(`Updating resource ${v.id} with:`,{title:F.trim(),description:D.trim(),newAttachments:G,removeAttachmentIds:te}),console.log(`Attachment files count: ${G.length}`),console.log(`Attachments to remove count: ${te.length}`),await Qs(v.id,{title:F.trim(),description:D.trim(),newAttachments:G,removeAttachmentIds:te});f({title:"Resource updated",description:"Your resource has been successfully updated with attachment changes",status:"success",duration:3e3,isClosable:!0}),y()}catch(n){console.error("Error updating resource with attachments:",n),f({title:"Update failed",description:((r=(t=n.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update the resource. Please try again.",status:"error",duration:4e3,isClosable:!0})}else{const n=localStorage.getItem("major_id")||i&&(i.major_id||((l=i.major)==null?void 0:l.id)),P=localStorage.getItem("faculty_id")||i&&(i.faculty_id||((g=i.faculty)==null?void 0:g.id));if(!n||!P){f({title:"Missing profile information",description:"Your major or faculty information is missing. Please re-login or complete your profile before posting.",status:"error",duration:4e3,isClosable:!0}),re(!1);return}const B=new FormData;if(B.append("title",F.trim()),B.append("description",D.trim()),B.append("type",C.type),B.append("major_id",n),B.append("faculty_id",P),A&&B.append("course_id",A),p==="event"?(B.append("event_date",ue),B.append("location",ne)):p==="study_group"&&B.append("study_date",Ye),Se&&(B.append("poll[question]",de),Q.forEach(L=>{L.trim()&&B.append("poll[options][]",L.trim())})),G.forEach(L=>{B.append("attachments[]",L)}),typeof z=="function"){const L=localStorage.getItem("major_id"),Fs=localStorage.getItem("faculty_id"),es={title:C.title,type:C.type,attachments:G,course_id:A,major_id:L,faculty_id:Fs};Se&&(es.poll={question:de,options:Q.filter(Ts=>Ts.trim()!=="")}),await z(C.content,es.type,es)}else await z(B);Ge(),y()}}catch(C){console.error("Error with resource:",C),f({title:"Error",description:((N=(m=C.response)==null?void 0:m.data)==null?void 0:N.message)||"Failed to process resource. Please try again.",status:"error",duration:4e3,isClosable:!0})}finally{re(!1)}},Je=async t=>{const r=Array.from(t.target.files);if(r.length!==0)try{f({title:"Uploading images...",status:"info",duration:2e3,isClosable:!0});const l=[],g=[];for(const m of r){if(!m.type.startsWith("image/")){f({title:"Invalid file type",description:`${m.name} is not an image file.`,status:"error",duration:3e3,isClosable:!0});continue}if(g.push(m),m.size>5*1024*1024){f({title:"File too large",description:`${m.name} exceeds the 5MB limit.`,status:"error",duration:3e3,isClosable:!0});continue}const N=Date.now(),C=Math.random().toString(36).substring(2,9),n=`img-${N}-${C}`,P=await os(m);l.push({id:n,name:m.name,type:m.type,size:m.size,url:P})}ce(m=>[...m,...g]),Z(m=>{const N=m.videos.length>0||m.documents.length>0;return N&&!p?W("Mixed Content"):!N&&!p&&W("Media"),{...m,images:[...m.images,...l]}}),l.length>0&&f({title:"Images uploaded successfully",status:"success",duration:3e3,isClosable:!0})}catch(l){f({title:"Error uploading images",description:l.message,status:"error",duration:3e3,isClosable:!0})}},Qe=async t=>{const r=Array.from(t.target.files);if(r.length!==0)try{re(!0);const l=r.filter(n=>n.type.startsWith("video/")||n.name.match(/\.(mp4|mov|avi|wmv|flv|webm|mkv)$/i));l.length!==r.length&&f({title:"Invalid file type",description:"Only video files are allowed for video upload",status:"warning",duration:3e3,isClosable:!0});const g=20*1024*1024,m=l.filter(n=>n.size<=g);m.length!==l.length&&f({title:"File too large",description:"Some videos exceed the 20MB size limit and will be skipped",status:"warning",duration:3e3,isClosable:!0});const C=(await Promise.all(m.map(async n=>{try{const P=await os(n);return{id:`video-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:n.name,url:P,size:n.size,type:"video",mimeType:n.type||"video/mp4"}}catch(P){return console.error(`Error processing video ${n.name}:`,P),null}}))).filter(n=>n!==null);C.length>0?(Z(n=>{const P=n.images.length>0||n.documents.length>0;return p!=="Media"&&!P?W("Media"):P&&!p&&W("Mixed Content"),{...n,videos:[...n.videos,...C].slice(0,2)}}),ce(n=>[...n,...m]),f({title:"Videos uploaded",description:`Successfully added ${C.length} videos`,status:"success",duration:3e3,isClosable:!0})):f({title:"Upload failed",description:"Failed to process any videos. Please try different files.",status:"error",duration:3e3,isClosable:!0}),t.target.value=null}catch(l){console.error("Error processing videos:",l),f({title:"Error uploading videos",description:"Please try again with different videos",status:"error",duration:3e3,isClosable:!0})}finally{re(!1)}},Ze=async t=>{const r=Array.from(t.target.files);if(r.length!==0)try{re(!0);const l=r.filter(n=>n.name.match(/\.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt)$/i));l.length!==r.length&&f({title:"Invalid file type",description:"Only document file types (PDF, Word, Excel, PowerPoint, etc.) are allowed",status:"warning",duration:3e3,isClosable:!0});const g=10*1024*1024,m=l.filter(n=>n.size<=g);m.length!==l.length&&f({title:"File too large",description:"Some documents exceed the 10MB size limit and will be skipped",status:"warning",duration:3e3,isClosable:!0});const C=(await Promise.all(m.map(async n=>{try{const P=await os(n),B=n.name.split(".").pop().toLowerCase();let L=n.type||"application/octet-stream";return(!n.type||n.type==="application/octet-stream")&&(B==="pdf"?L="application/pdf":["doc","docx"].includes(B)?L="application/msword":["xls","xlsx"].includes(B)?L="application/vnd.ms-excel":["ppt","pptx"].includes(B)?L="application/vnd.ms-powerpoint":B==="txt"&&(L="text/plain")),{id:`doc-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:n.name,url:P,size:n.size,type:"document",mimeType:L}}catch(P){return console.error(`Error processing document ${n.name}:`,P),null}}))).filter(n=>n!==null);C.length>0?(Z(n=>{const P=n.images.length>0||n.videos.length>0;return p!=="Course Material"&&!P?W("Course Material"):P&&!p&&W("Mixed Content"),{...n,documents:[...n.documents,...C].slice(0,4)}}),ce(n=>[...n,...m]),f({title:"Documents uploaded",description:`Successfully added ${C.length} documents`,status:"success",duration:3e3,isClosable:!0})):f({title:"Upload failed",description:"Failed to process any documents. Please try different files.",status:"error",duration:3e3,isClosable:!0}),t.target.value=null}catch(l){console.error("Error processing documents:",l),f({title:"Error uploading documents",description:"Please try again with different documents",status:"error",duration:3e3,isClosable:!0})}finally{re(!1)}},Ke=(t,r)=>{const l=se[t].find(g=>g.id===r);Z(g=>{const m={...g};return m[t]=g[t].filter(N=>N.id!==r),m}),ee&&l&&!isNaN(parseInt(l.id))&&(console.log(`Adding attachment ${l.id} to removal list`),Te(g=>[...g,l.id])),l&&ce(g=>g.filter(m=>m.name!==l.name))},a=()=>{me(!0)},j=()=>{Q.length<6?ae([...Q,""]):f({title:"Maximum poll options reached",description:"You can add up to 6 options",status:"warning",duration:2e3,isClosable:!0})},c=t=>{if(Q.length>1){const r=[...Q];r.splice(t,1),ae(r)}else f({title:"Minimum poll options required",description:"You need at least 1 option for a poll",status:"warning",duration:2e3,isClosable:!0})},T=()=>{if(!de.trim()){f({title:"Poll question is required",status:"error",duration:2e3,isClosable:!0});return}const t=Q.filter(g=>g.trim()!=="");if(t.length<1){f({title:"At least 1 poll option is required",status:"error",duration:2e3,isClosable:!0});return}const r=`poll-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,l={id:r,question:de,options:t.map((g,m)=>({id:`option-${m}-${r}`,text:g,votes:0})),createdAt:new Date().toISOString(),voters:[]};Z(g=>{const m=g.images.length>0||g.videos.length>0||g.documents.length>0;return m&&!p?W("Mixed Content"):!m&&!p&&W("Poll"),{...g,polls:[l]}}),Ce(!0),me(!1),f({title:"Poll added successfully",status:"success",duration:2e3,isClosable:!0})};return e.jsxs(e.Fragment,{children:[e.jsxs(ls,{isOpen:s,onClose:y,size:"lg",children:[e.jsx(as,{bg:"blackAlpha.600",backdropFilter:"blur(4px)"}),e.jsxs(cs,{borderRadius:"2xl",mx:4,overflow:"hidden",children:[e.jsx(ds,{bg:h("gray.50","gray.800"),borderBottomWidth:"1px",borderColor:O,pb:4,pt:3,children:e.jsxs(_,{align:"center",gap:3,children:[e.jsx(ms,{src:(b==null?void 0:b.avatar_url)||(b==null?void 0:b.avatar)||"https://i.pravatar.cc/150?img=12",size:"md",name:`${(b==null?void 0:b.first_name)||""} ${(b==null?void 0:b.last_name)||""}`.trim()||"You",border:"2px solid",borderColor:$}),e.jsxs(V,{align:"start",spacing:0,children:[e.jsx(d,{fontWeight:"bold",lineHeight:"short",color:S,children:`${(b==null?void 0:b.first_name)||""} ${(b==null?void 0:b.last_name)||""}`.trim()||"You"}),e.jsx(Y,{spacing:1,mt:1,children:e.jsx(d,{fontSize:"xs",color:h("gray.500","gray.400"),children:"Visible to everyone"})})]})]})}),e.jsx(us,{size:"lg",mt:1}),e.jsx(ps,{pt:5,pb:2,children:e.jsxs(V,{spacing:5,align:"stretch",children:[e.jsxs(Ae,{children:[e.jsx(ze,{fontSize:"sm",fontWeight:"semibold",mb:1,ml:1,color:h("gray.700","gray.300"),children:"Title"}),e.jsx(Ne,{placeholder:"Enter a title for your post...",value:F,onChange:t=>K(t.target.value),size:"md",borderRadius:"md",borderWidth:"2px",bg:h("white","gray.700"),p:3,_placeholder:{color:h("gray.400","gray.400")},_focus:{borderColor:$,boxShadow:`0 0 0 1px ${$}`}})]}),e.jsxs(Ae,{children:[e.jsx(ze,{fontSize:"sm",fontWeight:"semibold",mb:1,ml:1,color:h("gray.700","gray.300"),children:"Content"}),e.jsx(Ys,{placeholder:"Share your knowledge, resources, or ask a question...",value:D,onChange:t=>M(t.target.value),size:"md",borderRadius:"md",borderWidth:"2px",bg:h("white","gray.700"),minHeight:"140px",p:3,_placeholder:{color:h("gray.400","gray.400")},_focus:{borderColor:$,boxShadow:`0 0 0 1px ${$}`}}),e.jsx(_,{justify:"flex-end",mt:1.5,children:e.jsxs(d,{fontSize:"xs",color:D.length>480?"orange.500":"gray.500",children:[D.length,"/500 characters"]})})]}),e.jsxs(Ae,{children:[e.jsx(ze,{fontSize:"sm",fontWeight:"semibold",mb:1,ml:1,children:"Course"}),e.jsxs(Le,{children:[e.jsx(qe,{as:q,rightIcon:e.jsx(De,{}),w:"100%",variant:"outline",textAlign:"left",fontWeight:"normal",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:A&&pe.length>0?`${(I=pe.find(t=>t.id===Number(A)))==null?void 0:I.code} - ${(k=pe.find(t=>t.id===Number(A)))==null?void 0:k.title}`:"Select course"}),e.jsxs(He,{maxH:"320px",overflowY:"auto",children:[fe?e.jsx(_,{justify:"center",align:"center",h:"100px",children:e.jsx(gs,{})}):pe.map(t=>{var r;return e.jsx(xe,{onClick:()=>U(t.id),children:e.jsxs(x,{children:[e.jsxs(d,{fontWeight:"medium",children:[t.code," - ",t.title]}),e.jsx(d,{fontSize:"sm",color:"gray.500",children:(r=t.major)==null?void 0:r.name})]})},t.id)}),H>1&&e.jsx(x,{borderTop:"1px solid",borderColor:O,mt:2,pt:2,px:2,children:e.jsxs(_,{justify:"space-between",align:"center",children:[e.jsx(q,{size:"xs",variant:"outline",onClick:t=>{t.stopPropagation(),Ee(ge-1)},isDisabled:ge<=1||fe,children:"Prev"}),e.jsxs(d,{fontSize:"xs",color:"gray.500",children:["Page ",ge," of ",H]}),e.jsx(q,{size:"xs",variant:"outline",onClick:t=>{t.stopPropagation(),Ee(ge+1)},isDisabled:ge>=H||fe,children:"Next"})]})})]})]})]}),e.jsx(nt,{attachments:se,removeAttachment:Ke}),e.jsx(it,{handleImageUpload:Je,handleVideoUpload:Qe,handleDocumentUpload:Ze,handlePollAdd:a})]})}),e.jsx(js,{justifyContent:"end",px:4,py:3,borderTopWidth:"1px",borderColor:O,children:e.jsx(q,{colorScheme:"blue",leftIcon:e.jsx(Os,{}),isLoading:Ue,onClick:Xe,children:"Post"})})]})]}),e.jsxs(ls,{isOpen:J,onClose:()=>me(!1),size:"md",children:[e.jsx(as,{bg:"blackAlpha.600",backdropFilter:"blur(4px)"}),e.jsxs(cs,{borderRadius:"xl",children:[e.jsx(ds,{children:"Create Poll"}),e.jsx(us,{}),e.jsx(ps,{pb:6,children:e.jsxs(V,{spacing:4,align:"stretch",children:[e.jsxs(Ae,{isRequired:!0,children:[e.jsx(ze,{children:"Poll Question"}),e.jsx(Ne,{placeholder:"Enter your question",value:de,onChange:t=>Fe(t.target.value),autoFocus:!0})]}),e.jsxs(Ae,{isRequired:!0,children:[e.jsx(ze,{children:"Poll Options"}),e.jsx(V,{spacing:2,align:"stretch",children:Q.map((t,r)=>e.jsxs(_,{alignItems:"center",children:[e.jsx(Ne,{placeholder:`Option ${r+1}`,value:t,onChange:l=>{const g=[...Q];g[r]=l.target.value,ae(g)},mr:2}),Q.length>2&&e.jsx(q,{size:"sm",colorScheme:"red",variant:"ghost",onClick:()=>c(r),children:e.jsx(X,{as:Ds})})]},r))})]}),e.jsx(q,{leftIcon:e.jsx(X,{as:Bs}),variant:"outline",colorScheme:"blue",size:"sm",onClick:j,isDisabled:Q.length>=6,children:"Add Option"})]})}),e.jsxs(js,{children:[e.jsx(q,{colorScheme:"blue",mr:3,leftIcon:e.jsx(X,{as:Me}),onClick:T,children:"Create Poll"}),e.jsx(q,{onClick:()=>{Fe(""),ae(["",""]),me(!1)},children:"Cancel"})]})]})]})]})},at=async()=>{try{return(await hs.get("/registration/faculties")).data}catch(s){return console.error("Error fetching faculties:",s),[]}},ct=async s=>{if(!s)return[];try{return(await hs.get(`/registration/faculties/${s}/majors`)).data}catch(y){return console.error("Error fetching majors:",y),[]}},dt=async(s,y=1)=>{if(!s)return{data:[],current_page:1,last_page:1};try{return(await hs.get("/courses",{params:{major_id:s,page:y}})).data}catch(z){return console.error("Error fetching courses:",z),{data:[],current_page:1,last_page:1}}},jt=()=>{const s=h("rgba(255, 255, 255, 0.8)","rgba(45, 55, 72, 0.8)"),y=h("gray.800","white"),z=h("gray.500","gray.400"),R=h("blue.500","blue.200"),v=h("brand.navy","rgba(74, 85, 104, 0.3)");h("gray.50","gray.800"),h("blue.50","blue.900");const i=h("linear-gradient(135deg, #f0f4f8 0%, #eff6ff 50%, #f0f4f8 100%)","linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #1a202c 100%)"),u=Rs(),b=Ms();rs();const{isOpen:$,onOpen:O,onClose:S}=rs(),f=()=>{Te(null),S()},[F,K]=o.useState("feed"),[D,M]=o.useState(!0),[p,W]=o.useState("All"),[ee,w]=o.useState("All"),[A,U]=o.useState("All"),[ue,ye]=o.useState(""),[ne,ve]=o.useState(!1),[Ye,Pe]=o.useState([]),[Ue,re]=o.useState([]),[pe,we]=o.useState({data:[],current_page:1,last_page:1}),[fe,he]=o.useState(1),[ge,le]=o.useState(!1),{user:H}=zs(),[E,J]=o.useState([]),[me,de]=o.useState(1),[Fe,Q]=o.useState(1),[ae,Se]=o.useState(!1),[Ce,se]=o.useState(0),[Z,G]=o.useState(!0),ce=o.useRef(null),[te,Te]=o.useState(null);o.useEffect(()=>{(async()=>{le(!0);const j=await at();Pe(j);const c=JSON.parse(localStorage.getItem("user"));c!=null&&c.faculty_id&&W(c.faculty_id),le(!1)})()},[]),o.useEffect(()=>{if(!p||p==="All"){re([]),U("All");return}(async()=>{le(!0);const j=await ct(p);re(j);const c=JSON.parse(localStorage.getItem("user"));c!=null&&c.major_id&&parseInt(c.faculty_id)===parseInt(p)?U(c.major_id):U("All"),le(!1)})()},[p]),o.useEffect(()=>{if(!A||A==="All"){we({data:[],current_page:1,last_page:1}),w("All"),he(1);return}(async j=>{le(!0);const c=await dt(A,j);we(c),le(!1)})(fe)},[A,fe]);const ie=o.useCallback(async(a=1,j=!1)=>{var c,T;a===1?M(!0):Se(!0);try{const I={page:a,per_page:10,faculty_id:p!=="All"?p:void 0,major_id:A!=="All"?A:void 0,course_id:ee!=="All"?ee:void 0,search:ue||void 0};Object.keys(I).forEach(l=>I[l]===void 0&&delete I[l]);const k=await Zs(I,!0),t=Array.isArray(k)?k:k.data||[],r=k.pagination||{};j&&a>1?J(l=>[...l,...t]):J(t),de(r.current_page||a),Q(r.last_page||1),G(r.current_page<r.last_page)}catch(I){console.error("Error loading resource data:",I),u({title:"Error loading resources",description:((T=(c=I.response)==null?void 0:c.data)==null?void 0:T.message)||"There was a problem loading the API resource data.",status:"error",duration:3e3,isClosable:!0})}finally{M(!1),Se(!1)}},[p,A,ee,ue,u]);o.useEffect(()=>{ie(1,!1),de(1),G(!0)},[ie]),o.useEffect(()=>{const a=new IntersectionObserver(c=>{const[T]=c;T.isIntersecting&&Z&&!ae&&!D&&ie(me+1,!0)},{threshold:1}),j=ce.current;return j&&a.observe(j),()=>{j&&a.unobserve(j)}},[me,Z,ae,D,ie]);const Ee=o.useCallback(a=>{b(`/resources/${a}`)},[b]),Ge=o.useCallback((a,j)=>{const c=E.findIndex(t=>t.id===a);if(c===-1)return;const T=E[c],I=T.is_saved,k=[...E];k[c]={...T,is_saved:!I},J(k),Ks(a).then(t=>{u(ts(`${I?"Removed from":"Added to"} bookmarks: ${j}`,null,2e3));const r=typeof(t==null?void 0:t.is_saved)=="boolean"?t.is_saved:!I,l=[...E];l[c]={...l[c],is_saved:r},J(l)}).catch(t=>{Ie("handleBookmark",t);const r=[...E];r[c]={...T,is_saved:I},J(r),u(ke(t,`Failed to ${I?"remove from":"add to"} bookmarks`))})},[E,u]),Xe=o.useCallback(a=>{const j=E.findIndex(k=>k.id===a);if(j===-1)return;const c=E[j],T={...c,is_upvoted:!c.is_upvoted,upvote_count:c.upvote_count+(c.is_upvoted?-1:1)},I=[...E];I[j]=T,J(I),et(a).then(k=>{const t=E.findIndex(l=>l.id===a);if(t===-1)return;const r=[...E];r[t]={...r[t],is_upvoted:k.upvoted,upvote_count:k.upvote_count},J(r)}).catch(k=>{Ie("toggleUpvote",k);const t=E.findIndex(g=>g.id===a);if(t===-1)return;const r={...E[t],is_upvoted:c.is_upvoted,upvote_count:c.upvote_count},l=[...E];l[t]=r,J(l),u(ke(k,"Failed to update upvote"))})},[E,u]);o.useCallback(async(a,j)=>{try{const c=await addComment(a,j),T=E.findIndex(k=>k.id===a);if(T===-1)return;const I=[...E];return I[T]={...I[T],comment_count:c.comment_count},J(I),u(ts("Comment added",null,2e3)),c.comment}catch(c){Ie("handleAddComment",c),u(ke(c,"Failed to add comment"))}},[E,u]);const Je=o.useCallback((a,j)=>{console.log(`Resource ${a} shared via ${j||"general"}`),(!j||j==="general")&&u({title:`Shared resource #${a}`,status:"info",duration:1500,isClosable:!0})},[u]),Qe=(a,j,c)=>{M(!0);const T=c.title||"New Resource",I=a,k=c.attachments||[];k.length>0&&console.log(`Uploading ${k.length} attachments with resource`);const t={title:T,description:I,attachments:k,course_id:c.course_id,major_id:c.major_id,faculty_id:c.faculty_id,type:j};c.poll&&c.poll.question&&c.poll.options&&(t.poll={question:c.poll.question,options:c.poll.options},console.log("Adding poll data to createResource payload:",t.poll)),st(t).then(r=>{u({title:"Resource submitted successfully",description:"Your resource has been submitted and is pending approval. You will be notified once it is reviewed.",status:"success",duration:5e3,isClosable:!0})}).catch(r=>{var l,g;console.error("Error creating resource:",r),u({title:"Failed to create resource",description:r.message||((g=(l=r.response)==null?void 0:l.data)==null?void 0:g.message)||"Please try again later",status:"error",duration:3e3,isClosable:!0})}).finally(()=>{M(!1)})},Ze=o.useCallback(a=>{Te({id:a.id,title:a.title,description:a.description,attachments:a.attachments||[]}),O()},[O]),Ke=o.useCallback(async a=>{try{J(j=>j.filter(c=>c.id!==a))}catch(j){Ie("handleDelete",j),u(ke(j,"There was a problem updating the UI after deletion"))}},[u]);return e.jsxs(x,{position:"relative",bg:i,minH:"calc(100vh - 60px)",py:5,px:{base:4,md:6,lg:8},overflow:"hidden",children:[e.jsx(x,{position:"absolute",top:"5%",right:"5%",width:"300px",height:"300px",borderRadius:"full",bg:"brand.navy",opacity:"0.05",filter:"blur(70px)",zIndex:0}),e.jsx(x,{position:"absolute",bottom:"10%",left:"5%",width:"250px",height:"250px",borderRadius:"full",bg:"brand.gold",opacity:"0.08",filter:"blur(60px)",zIndex:0}),D&&Ce<100&&e.jsx(x,{position:"fixed",top:"0",left:"0",right:"0",zIndex:"1000",children:e.jsx(ks,{size:"xs",value:Ce,colorScheme:"blue",isAnimated:!0})}),e.jsxs(_,{maxW:"1400px",mx:"auto",gap:{base:2,md:4,lg:6},px:{base:2,md:4},children:[e.jsx(lt,{isOpen:$,onClose:f,user:H,addNewPost:Qe,editResource:te,updateResource:async a=>{var j,c;try{const{updateResource:T}=await Ls(async()=>{const{updateResource:k}=await import("./resourceService-BPsVWu4e.js");return{updateResource:k}},__vite__mapDeps([0,1,2,3]));console.log("Updating resource with full data:",a),console.log("Attachments data received:",{newAttachments:a.newAttachments||[],attachmentFiles:a.attachmentFiles||[],removeAttachmentIds:a.removeAttachmentIds||[],attachmentsToRemove:a.attachmentsToRemove||[]});const I=await T(a.id,{title:a.title,description:a.description,newAttachments:a.attachmentFiles||a.newAttachments||[],removeAttachmentIds:a.attachmentsToRemove||a.removeAttachmentIds||[]});return J(k=>k.map(t=>t.id===a.id?{...t,...I}:t)),u(ts("Resource updated",((j=a.attachmentsToRemove)==null?void 0:j.length)>0||((c=a.newAttachments)==null?void 0:c.length)>0?"Resource and attachments updated successfully":"Resource updated successfully",3e3)),I}catch(T){throw Ie("updateResource",T),u(ke(T,"Failed to update the resource")),T}}}),e.jsx(x,{flex:"1",maxW:{base:"100%",lg:"calc(100% - 340px)"},order:{base:1,lg:1},children:e.jsxs(V,{spacing:6,align:"stretch",children:[e.jsxs(Y,{spacing:4,children:[e.jsx(ns,{icon:e.jsx(xs,{}),"aria-label":"Go back",onClick:()=>b(-1),variant:"ghost",borderRadius:"full"}),e.jsx(is,{size:"xl",color:y,fontWeight:"700",children:"Resources Feed"})]}),e.jsxs(x,{position:"sticky",top:"0",zIndex:"10",py:4,backdropFilter:"blur(10px)",mb:4,children:[e.jsxs(_,{align:"center",gap:4,maxW:"1000px",mx:"auto",children:[e.jsxs(Us,{size:"lg",flex:"1",children:[e.jsx(Gs,{pointerEvents:"none",children:e.jsx(Ss,{color:"gray.400"})}),e.jsx(Ne,{placeholder:"Search resources...",bg:h("white","gray.700"),borderRadius:"full",boxShadow:"0px 3px 10px rgba(0, 0, 0, 0.05)",value:ue,onChange:a=>ye(a.target.value),borderColor:h("rgba(226, 232, 240, 0.8)","gray.600"),_focus:{boxShadow:"0px 4px 12px rgba(66, 153, 225, 0.15)",borderColor:h("blue.300","blue.400")},_hover:{borderColor:h("blue.200","blue.500")}}),ue&&e.jsx(Xs,{children:e.jsx(ns,{size:"sm",variant:"ghost",icon:e.jsx(xs,{}),onClick:()=>ye(""),"aria-label":"Clear search",borderRadius:"full"})})]}),e.jsx(q,{leftIcon:e.jsx(Cs,{}),onClick:()=>ve(!ne),bg:ne?"blue.500":h("white","gray.700"),color:ne?"white":y,borderRadius:"full",boxShadow:"0px 3px 10px rgba(0, 0, 0, 0.05)",borderColor:h("rgba(226, 232, 240, 0.8)","gray.600"),border:"1px solid",_hover:{bg:ne?"blue.600":h("gray.50","gray.600"),transform:"translateY(-2px)",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.08)"},transition:"all 0.2s ease-in-out",children:e.jsx(d,{as:"span",children:"Filter"})})]}),ne&&e.jsx(x,{mt:4,bg:s,p:4,borderRadius:"lg",boxShadow:"md",children:e.jsx(ot,{searchQuery:ue,facultyFilter:p,setFacultyFilter:W,courseFilter:ee,setCourseFilter:w,majorFilter:A,setMajorFilter:U,faculties:Ye,majors:Ue,courses:pe.data,coursePagination:pe,onCoursePageChange:he,isLoadingFilters:ge,showFilters:ne,onToggleFilters:()=>ve(!ne),onClearFilters:()=>{W("All"),w("All"),U("All")}})})]}),e.jsx(x,{bg:s,borderRadius:"xl",boxShadow:"sm",p:3,mb:6,border:"1px solid",borderColor:v,cursor:"pointer",onClick:O,_hover:{boxShadow:"md",transform:"translateY(-1px)"},transition:"all 0.2s ease",children:e.jsxs(Y,{spacing:3,pointerEvents:"none",children:[e.jsx(ms,{size:"md",name:H?`${H.first_name} ${H.last_name}`:"User",src:(H==null?void 0:H.avatar_url)||(H==null?void 0:H.avatar),border:"2px solid",borderColor:h("blue.200","blue.700")}),e.jsx(x,{flex:"1",bg:h("gray.50","gray.700"),borderRadius:"full",px:4,py:2.5,transition:"all 0.2s",border:"1px solid",borderColor:h("gray.200","gray.600"),children:e.jsx(d,{color:z,fontSize:"sm",children:"What's on your mind?"})})]})}),e.jsxs(x,{w:"full",maxW:{base:"100%",md:"650px",lg:"100%"},mx:"auto",position:"relative",children:[e.jsx(tt,{resources:E,cardBg:s,textColor:y,mutedText:z,borderColor:v,isLoading:D,feedType:F,currentUser:H,onCardClick:Ee,onBookmark:Ge,onUpvote:Xe,onShare:Je,onEdit:Ze,onDelete:Ke}),Z&&e.jsx(x,{ref:ce,py:6,textAlign:"center",children:ae?e.jsx(gs,{size:"md",color:R,thickness:"3px",speed:"0.65s"}):e.jsx(d,{fontSize:"sm",color:z,children:"Scroll for more"})}),!Z&&E.length>10&&e.jsx(x,{py:6,textAlign:"center",children:e.jsx(d,{fontSize:"sm",color:z,children:"No more resources to load."})})]})]})}),e.jsx(x,{display:{base:"none",lg:"block"},order:{base:2,lg:2},width:"320px",flexShrink:"0",children:e.jsx(x,{position:"sticky",top:"20px",width:"320px",maxHeight:"calc(100vh - 40px)",overflowY:"auto",paddingRight:"2",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{width:"6px",backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{background:h("rgba(0,0,0,0.1)","rgba(255,255,255,0.1)"),borderRadius:"24px"}},children:e.jsx(rt,{limit:5})})})]})]})};export{jt as default};
